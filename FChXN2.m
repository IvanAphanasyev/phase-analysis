%FChXN2(21092018)
clc; clear all; close all;
p=2; %??????? ???????
xmin=0.05; % ws ?? 0.05
xmax=0.95; % ?? 0.95
N=73; 
RP=3;
% RP=8.0;
RS=12.0;
ws=linspace(xmin,xmax,N);
%FChX_FNC
for i=1:length(ws)
    [alb,blb]=butter(p,ws(i),'low'); % ?????? ????????????? "?" ? "b"
    [alc1,blc1]=cheby1(p,RP,ws(i),'low'); % ?????? ????????????? "?" ? "b"
    [alc2,blc2]=cheby2(p,RS,ws(i),'low'); % ?????? ????????????? "?" ? "b"+
    [ale,ble]=ellip(p,RP,RS,ws(i),'low'); % ?????? ????????????? "?" ? "b"
    Kal(i,1)=alb(1); %?????? ??????? ?????????? Ka ????????????? ???????????? ?1 butter
    Kal(i,2)=alb(2); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 butter
    Kal(i,3)=alb(3); %?????? ??????? ?????????? Ka ????????????? ???????????? ?3 butter
    Kal(i,4)=alc1(1); %?????? ??????? ?????????? Ka ????????????? ???????????? ?1 cheby1
    Kal(i,5)=alc1(2); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 cheby1
    Kal(i,6)=alc1(3); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 cheby1
    Kal(i,7)=alc2(1); %?????? ??????? ?????????? Ka ????????????? ???????????? ?1 cheby2
    Kal(i,8)=alc2(2); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 cheby2
    Kal(i,9)=alc2(3); %?????? ??????? ?????????? Ka ????????????? ???????????? ?3 cheby2
    Kal(i,10)=ale(1); %????????? ??????? ?????????? Ka ????????????? ???????????? ?1 ellip
    Kal(i,11)=ale(2); %????????? ??????? ?????????? Ka ????????????? ???????????? ?2 ellip
    Kal(i,12)=ale(3); %????????? ??????? ?????????? Ka ????????????? ???????????? ?3 ellip
    Kbl(i,1)=blb(1); %?????? ??????? ?????????? Kb ????????????? ???????????? b1 butter
    Kbl(i,2)=blb(2); %?????? ??????? ?????????? Kb ????????????? ???????????? b2 butter
    Kbl(i,3)=blb(3); %?????? ??????? ?????????? Kb ????????????? ???????????? b3 butter
    Kbl(i,4)=blc1(1); %?????? ??????? ?????????? Kb ????????????? ???????????? b1 cheby1
    Kbl(i,5)=blc1(2); %?????? ??????? ?????????? Kb ????????????? ???????????? b2 cheby1
    Kbl(i,6)=blc1(3); %?????? ??????? ?????????? Kb ????????????? ???????????? b3 cheby1
    Kbl(i,7)=blc2(1); %?????? ?????? ?????????? ?b ????????????? ???????????? b1 cheby2 
    Kbl(i,8)=blc2(2); %?????? ?????? ?????????? ?b ????????????? ???????????? b2 cheby2
    Kbl(i,9)=blc2(3); %?????? ?????? ?????????? ?b ????????????? ???????????? b3 cheby2
    Kbl(i,10)=ble(1); %????????? ?????? ?????????? ?b ????????????? ???????????? b1 ellip
    Kbl(i,11)=ble(2); %????????? ?????? ?????????? ?b ????????????? ???????????? b2 ellip
    Kbl(i,12)=ble(3); %????????? ?????? ?????????? ?b ????????????? ???????????? b3 ellip
end
%%ws(37)=0.5, 45=0.6, 21=0.3
%ws(13)=0.2;(29)=0.4;(45)=0.6;(61)=0.8
%Ka=1=butt;2=cheb1;3=cheb2;4=ell
%Kb=1=butt;2=cheb1;3=cheb2;4=ell

nw=37;
TF=4;
al=[Kal(nw,TF) Kal(nw,TF+1) Kal(nw,TF+2)];
bl=[Kbl(nw,TF) Kbl(nw,TF+1) Kbl(nw,TF+2)];
[hl,w]=freqz(al,bl,100);
aml=abs(hl);
phal=angle(hl);
% pbl=(1-Kbl(37,TF))/(1+Kbl(37,TF));
% pharl=-atan(pbl*tan(w/2));
for i=1:length(w)
    amlP(i)=1/(sqrt(10^(0.1*RP)));
    amlS(i)=1/(sqrt(10^(0.1*RS)));
end

figure(1)
subplot(2,1,1)
plot(w/pi,aml,w/pi,amlP,w/pi,amlS)
grid  
subplot(2,1,2)
plot(w/pi,phal)
grid 
%FCH
for i=1:length(w)
    CF1(i)=(bl(2)*(al(1)-al(3))-al(2)*(1-bl(3)))*sin(w(i));
    CF2(i)=(al(1)*bl(3)-al(3))*sin(2*w(i));
    IF(i)=CF1(i)+CF2(i);
    ZF1(i)=al(1)+al(2)*bl(2)+al(3)*bl(3);
    ZF2(i)=(bl(2)*(al(1)+al(3))+al(2)*(1+bl(3)))*cos(w(i));
    ZF3(i)=(al(1)*bl(3)+al(3))*cos(2*w(i));
    RF(i)=ZF1(i)+ZF2(i)+ZF3(i);
    %F2(i)=atan((CF1(i)+CF2(i))/(ZF1(i)+ZF2(i)+ZF3(i)));
    F2(i)=atan2(IF(i),RF(i));
    
end
for i=1:length(w)
    phal90(1,i)=-pi/2;
end
figure(2)
plot(w/pi,phal)
%,w/pi,F2)
grid 
figure(3)
plot(w/pi,phal,w/pi,F2,w/pi,phal90)
grid 
stop
%
% [alb,blb]=cheby1(p,RP,0.5,'low')
% [ahb,bhb]=cheby1(p,RP,0.5,'high')
%%FChX_FVC
% RP=3.0;
% RS=10.0;
% for i=1:length(ws)
%     [ahb,bhb]=butter(p,ws(i),'high'); % ?????? ????????????? "?" ? "b"
%     [ahc1,bhc1]=cheby1(p,RP,ws(i),'high'); % ?????? ????????????? "?" ? "b"
%     [ahc2,bhc2]=cheby2(p,RS,ws(i),'high'); % ?????? ????????????? "?" ? "b"+
%     [ahe,bhe]=ellip(p,RP,RS,ws(i),'high'); % ?????? ????????????? "?" ? "b"
%     Kah(i,1)=ahb(1); %?????? ??????? ?????????? Ka ????????????? ???????????? ?1 butter
%     Kah(i,2)=ahb(2); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 butter
%     Kah(i,3)=ahb(3); %?????? ??????? ?????????? Ka ????????????? ???????????? ?3 butter
%     Kah(i,4)=ahc1(1); %?????? ??????? ?????????? Ka ????????????? ???????????? ?1 cheby1
%     Kah(i,5)=ahc1(2); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 cheby1
%     Kah(i,6)=ahc1(3); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 cheby1
%     Kah(i,7)=ahc2(1); %?????? ??????? ?????????? Ka ????????????? ???????????? ?1 cheby2
%     Kah(i,8)=ahc2(2); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 cheby2
%     Kah(i,9)=ahc2(3); %?????? ??????? ?????????? Ka ????????????? ???????????? ?3 cheby2
%     Kah(i,10)=ahe(1); %????????? ??????? ?????????? Ka ????????????? ???????????? ?1 ellip
%     Kah(i,11)=ahe(2); %????????? ??????? ?????????? Ka ????????????? ???????????? ?2 ellip
%     Kah(i,12)=ahe(3); %????????? ??????? ?????????? Ka ????????????? ???????????? ?3 ellip
%     Kbh(i,1)=bhb(1); %?????? ??????? ?????????? Kb ????????????? ???????????? b1 butter
%     Kbh(i,2)=bhb(2); %?????? ??????? ?????????? Kb ????????????? ???????????? b2 butter
%     Kbh(i,3)=bhb(3); %?????? ??????? ?????????? Kb ????????????? ???????????? b3 butter
%     Kbh(i,4)=bhc1(1); %?????? ??????? ?????????? Kb ????????????? ???????????? b1 cheby1
%     Kbh(i,5)=bhc1(2); %?????? ??????? ?????????? Kb ????????????? ???????????? b2 cheby1
%     Kbh(i,6)=bhc1(3); %?????? ??????? ?????????? Kb ????????????? ???????????? b3 cheby1
%     Kbh(i,7)=bhc2(1); %?????? ?????? ?????????? ?b ????????????? ???????????? b1 cheby2 
%     Kbh(i,8)=bhc2(2); %?????? ?????? ?????????? ?b ????????????? ???????????? b2 cheby2
%     Kbh(i,9)=bhc2(3); %?????? ?????? ?????????? ?b ????????????? ???????????? b3 cheby2
%     Kbh(i,10)=bhe(1); %????????? ?????? ?????????? ?b ????????????? ???????????? b1 ellip
%     Kbh(i,11)=bhe(2); %????????? ?????? ?????????? ?b ????????????? ???????????? b2 ellip
%     Kbh(i,12)=bhe(3); %????????? ?????? ?????????? ?b ????????????? ???????????? b3 ellip
% end
% %%ws(37)=0.5, 45=0.6
% %ws(13)=0.2;(29)=0.4;(45)=0.6;(61)=0.8
% %Ka=1=butt;2=cheb1;3=cheb2;4=ell
% %Kb=1=butt;2=cheb1;3=cheb2;4=ell
% 
% nw=45;
% TF=10;
% ah=[Kah(nw,TF) Kah(nw,TF+1) Kah(nw,TF+2)];
% bh=[Kbh(nw,TF) Kbh(nw,TF+1) Kbh(nw,TF+2)];
% [hh,w]=freqz(ah,bh,100);
% amh=abs(hh);
% phah=angle(hh);
% 
% for i=1:length(w)
%     amhP(i)=1/(sqrt(10^(0.1*RP)));
%     amhS(i)=1/(sqrt(10^(0.1*RS)));
% end
% 
% figure(1)
% subplot(2,1,1)
% plot(w/pi,amh,w/pi,amhP,w/pi,amhS)
% grid  
% subplot(2,1,2)
% plot(w/pi,phah)
% grid  
% stop
%FChX_PF
% p=1; %??????? ???????
% RP=3.0;
% RS=10.0;
% Wn=[0.3 0.7];
% W0c=(Wn(1)+Wn(2))/2
% W0k=sqrt(Wn(1)*Wn(2))
% 
% % for i=1:length(ws)
%     [apb,bpb]=butter(p,Wn); % ?????? ????????????? "?" ? "b"
%     [apc1,bpc1]=cheby1(p,RP,Wn); % ?????? ????????????? "?" ? "b"
%     [apc2,bpc2]=cheby2(p,RS,Wn); % ?????? ????????????? "?" ? "b"+
%     [ape,bpe]=ellip(p,RP,RS,Wn); % ?????? ????????????? "?" ? "b"
%     Kap(1)=apb(1); %?????? ??????? ?????????? Ka ????????????? ???????????? ?1 butter
%     Kap(2)=apb(2); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 butter
%     Kap(3)=apb(3); %?????? ??????? ?????????? Ka ????????????? ???????????? ?3 butter
%     Kap(4)=apc1(1); %?????? ??????? ?????????? Ka ????????????? ???????????? ?1 cheby1
%     Kap(5)=apc1(2); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 cheby1
%     Kap(6)=apc1(3); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 cheby1
%     Kap(7)=apc2(1); %?????? ??????? ?????????? Ka ????????????? ???????????? ?1 cheby2
%     Kap(8)=apc2(2); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 cheby2
%     Kap(9)=apc2(3); %?????? ??????? ?????????? Ka ????????????? ???????????? ?3 cheby2
%     Kap(10)=ape(1); %????????? ??????? ?????????? Ka ????????????? ???????????? ?1 ellip
%     Kap(11)=ape(2); %????????? ??????? ?????????? Ka ????????????? ???????????? ?2 ellip
%     Kap(12)=ape(3); %????????? ??????? ?????????? Ka ????????????? ???????????? ?3 ellip
%     Kbp(1)=bpb(1); %?????? ??????? ?????????? Kb ????????????? ???????????? b1 butter
%     Kbp(2)=bpb(2); %?????? ??????? ?????????? Kb ????????????? ???????????? b2 butter
%     Kbp(3)=bpb(3); %?????? ??????? ?????????? Kb ????????????? ???????????? b3 butter
%     Kbp(4)=bpc1(1); %?????? ??????? ?????????? Kb ????????????? ???????????? b1 cheby1
%     Kbp(5)=bpc1(2); %?????? ??????? ?????????? Kb ????????????? ???????????? b2 cheby1
%     Kbp(6)=bpc1(3); %?????? ??????? ?????????? Kb ????????????? ???????????? b3 cheby1
%     Kbp(7)=bpc2(1); %?????? ?????? ?????????? ?b ????????????? ???????????? b1 cheby2 
%     Kbp(8)=bpc2(2); %?????? ?????? ?????????? ?b ????????????? ???????????? b2 cheby2
%     Kbp(9)=bpc2(3); %?????? ?????? ?????????? ?b ????????????? ???????????? b3 cheby2
%     Kbp(10)=bpe(1); %????????? ?????? ?????????? ?b ????????????? ???????????? b1 ellip
%     Kbp(11)=bpe(2); %????????? ?????? ?????????? ?b ????????????? ???????????? b2 ellip
%     Kbp(12)=bpe(3); %????????? ?????? ?????????? ?b ????????????? ???????????? b3 ellip
% % end
% %%ws(37)=0.5, 45=0.6
% %ws(13)=0.2;(29)=0.4;(45)=0.6;(61)=0.8
% %Ka=1=butt;4=cheb1;7=cheb2;10=ell
% %Kb=1=butt;4=cheb1;7=cheb2;10=ell
% 
% TF=4;
% ap=[Kap(TF) Kap(TF+1) Kap(TF+2)];
% bp=[Kbp(TF) Kbp(TF+1) Kbp(TF+2)];
% [hp,w]=freqz(ap,bp,100);
% amp=abs(hp);
% phap=angle(hp);
% 
% for i=1:length(w)
%     ampP(i)=1/(sqrt(10^(0.1*RP)));
%     ampS(i)=1/(sqrt(10^(0.1*RS)));
% end
% 
% figure(1)
% subplot(2,1,1)
% plot(w/pi,amp,w/pi,ampP,w/pi,ampS)
% grid  
% subplot(2,1,2)
% plot(w/pi,phap)
% grid  
% stop
%%FChX_RF
p=1; %??????? ???????
RP=3.0;
RS=10.0;
Wn=[0.3 0.7];
% W0c=(Wn(1)+Wn(2))/2
% W0k=sqrt(Wn(1)*Wn(2))

% for i=1:length(ws)
    [arb,brb]=butter(p,Wn); % ?????? ????????????? "?" ? "b"
    [arc1,brc1]=cheby1(p,RP,Wn,'stop'); % ?????? ????????????? "?" ? "b"
    [arc2,brc2]=cheby2(p,RS,Wn,'stop'); % ?????? ????????????? "?" ? "b"+
    [are,bre]=ellip(p,RP,RS,Wn,'stop'); % ?????? ????????????? "?" ? "b"
    Kar(1)=arb(1); %?????? ??????? ?????????? Ka ????????????? ???????????? ?1 butter
    Kar(2)=arb(2); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 butter
    Kar(3)=arb(3); %?????? ??????? ?????????? Ka ????????????? ???????????? ?3 butter
    Kar(4)=arc1(1); %?????? ??????? ?????????? Ka ????????????? ???????????? ?1 cheby1
    Kar(5)=arc1(2); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 cheby1
    Kar(6)=arc1(3); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 cheby1
    Kar(7)=arc2(1); %?????? ??????? ?????????? Ka ????????????? ???????????? ?1 cheby2
    Kar(8)=arc2(2); %?????? ??????? ?????????? Ka ????????????? ???????????? ?2 cheby2
    Kar(9)=arc2(3); %?????? ??????? ?????????? Ka ????????????? ???????????? ?3 cheby2
    Kar(10)=are(1); %????????? ??????? ?????????? Ka ????????????? ???????????? ?1 ellip
    Kar(11)=are(2); %????????? ??????? ?????????? Ka ????????????? ???????????? ?2 ellip
    Kar(12)=are(3); %????????? ??????? ?????????? Ka ????????????? ???????????? ?3 ellip
    Kbr(1)=brb(1); %?????? ??????? ?????????? Kb ????????????? ???????????? b1 butter
    Kbr(2)=brb(2); %?????? ??????? ?????????? Kb ????????????? ???????????? b2 butter
    Kbr(3)=brb(3); %?????? ??????? ?????????? Kb ????????????? ???????????? b3 butter
    Kbr(4)=brc1(1); %?????? ??????? ?????????? Kb ????????????? ???????????? b1 cheby1
    Kbr(5)=brc1(2); %?????? ??????? ?????????? Kb ????????????? ???????????? b2 cheby1
    Kbr(6)=brc1(3); %?????? ??????? ?????????? Kb ????????????? ???????????? b3 cheby1
    Kbr(7)=brc2(1); %?????? ?????? ?????????? ?b ????????????? ???????????? b1 cheby2 
    Kbr(8)=brc2(2); %?????? ?????? ?????????? ?b ????????????? ???????????? b2 cheby2
    Kbr(9)=brc2(3); %?????? ?????? ?????????? ?b ????????????? ???????????? b3 cheby2
    Kbr(10)=bre(1); %????????? ?????? ?????????? ?b ????????????? ???????????? b1 ellip
    Kbr(11)=bre(2); %????????? ?????? ?????????? ?b ????????????? ???????????? b2 ellip
    Kbr(12)=bre(3); %????????? ?????? ?????????? ?b ????????????? ???????????? b3 ellip
% end
%%ws(37)=0.5, 45=0.6
%ws(13)=0.2;(29)=0.4;(45)=0.6;(61)=0.8
%Ka=1=butt;4=cheb1;7=cheb2;10=ell
%Kb=1=butt;4=cheb1;7=cheb2;10=ell

TF=1;
ar=[Kar(TF) Kar(TF+1) Kar(TF+2)];
br=[Kbr(TF) Kbr(TF+1) Kbr(TF+2)];
[hr,w]=freqz(ar,br,100);
amr=abs(hr);
for i=1:length(amr)
    amr2(i)=amr(i)^2;
end
phar=angle(hr);

for i=1:length(w)
    amrP(i)=1/(sqrt(10^(0.1*RP)));
    amrS(i)=1/(sqrt(10^(0.1*RS)));
    amr5(i)=0.5;
end

% figure(1)
% subplot(2,1,1)
% plot(w/pi,amr,w/pi,amrP,w/pi,amrS,w/pi,amr2)
% grid  
% subplot(2,1,2)
% plot(w/pi,phar)
% grid  
%
figure(1)
plot(w/pi,amr,w/pi,amrP,w/pi,amrS,w/pi,amr5,w/pi,amr2)
grid  
%ACH
for i=1:length(w)
    C1(i)=(ar(1)-ar(3))^2+ar(2)^2;
    C2(i)=2*ar(2)*(ar(1)+ar(3))*cos(w(i));
    C3(i)=4*ar(1)*ar(3)*(cos(w(i)))^2;
    Z1(i)=(1-br(3))^2+br(2)^2;
    Z2(i)=2*br(2)*(1+br(3))*cos(w(i));
    Z3(i)=4*br(3)*(cos(w(i)))^2;
    H2(i)=(C1(i)+C2(i)+C3(i))/(Z1(i)+Z2(i)+Z3(i));
    
end
figure(2)
plot(w/pi,amr,w/pi,H2,w/pi,amrP,w/pi,amrS,w/pi,amr5,w/pi,amr2)
grid 
%FCH
for i=1:length(w)
    CF1(i)=(br(2)*(ar(1)-ar(3))-ar(2)*(1-br(3)))*sin(w(i));
    CF2(i)=(ar(1)*br(3)-ar(3))*sin(2*w(i));
    ZF1(i)=ar(1)+ar(2)*br(2)+ar(3)*br(3);
    ZF2(i)=(br(2)*(ar(1)+ar(3))+ar(2)*(1+br(3)))*cos(w(i));
    ZF3(i)=(ar(1)*br(3)+ar(3))*cos(2*w(i));
    F2(i)=atan((CF1(i)+CF2(i))/(ZF1(i)+ZF2(i)+ZF3(i)));
    
end
figure(3)
plot(w/pi,phar)
%,w/pi,F2)
grid 
figure(4)
plot(w/pi,phar,w/pi,F2)
grid 

stop


